<!DOCTYPE html>
<html>
<head>
  <title>SmartBunks Attendance Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
  />
  <!-- In <head> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/static/data/style/style.css">

</head>
<body> 
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow-sm py-3 px-4">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/">SmartBunks</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#home" data-section="home">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#headform" data-section="headform">Form</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#attendance-summary" data-section="attendance-summary">Summary</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



<!--Landing Section -->
<section class="hero-section d-flex align-items-center" id="home">


  <div class="container text-white text-center text-lg-start">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-4 fw-bold mb-3">SmartBunks</h1>
        <p class="lead mb-4">Plan your leaves smartly. Stay above your attendance threshold.</p>
        <a href="#headform" class="btn btn-success btn-lg">Letâ€™s Bunk!</a>
        <!-- <div class="mt-4 d-flex justify-content-center justify-content-lg-start gap-3">
          <a href="#headform" class="text-white text-decoration-none small">Explore Features</a>
          <a href="#attendance-summary" class="text-white text-decoration-none small">View Summary</a>
        </div> -->
      </div>
<div class="col-lg-6 text-center">
        <img src="/static/data/images/herosec.png" alt="Attendance Illustration" class="herosec img-fluid rounded shadow" style="max-height: 400px;" />
        <!-- Collapsible Trigger -->
    <a href="#workingCollapse" class="colbtn"><button class="btn colbtn mb-4" type="button" data-bs-toggle="collapse" data-bs-target="#workingCollapse" aria-expanded="false" aria-controls="workingCollapse">
      ðŸ“˜ Click to understand the working
    </button></a>


<!-- Collapsible Content -->
    <div class="collapse" id="workingCollapse">
      <div class="card card-body collapsible-dark-card  text-start mx-auto" style="max-width: 700px; margin-top: +20px;">
        <p class="mb-3 fw-lighter ">
          Just input your weekly timetable (which subjects you have on each weekday), select your session's start and end dates, and set the attendance threshold (e.g., 75%). SmartBunks will instantly calculate:
        </p>
        <ul class="list-unstyled mb-4 fw-light">
          <li>âœ… Total number of classes expected in the session per subject</li>
          <li>âœ… Minimum required attendance to stay above the threshold</li>
          <li>âœ… Maximum number of leaves you can safely take</li>
        </ul>

        <hr>

        <p><b>Example:</b></p>
        <p>
          Letâ€™s say you select a session from <b>August 1 to November 30</b>, with a <b>75% attendance threshold</b>.<br>
          SmartBunks calculates that you'll have <b>40 lectures of Subject X</b> during this period.
        </p>
        <p>
          To maintain 75% attendance, you need to attend at least <b>30 lectures</b>. So, you can take up to <b>10 leaves</b>.
        </p>
        <p>
          If you've already taken <b>4 leaves</b>, youâ€™re left with <b>6 more safe leaves</b> for that subject.
        </p>
        <p class="mb-0">
          This helps you plan your future leaves without risking attendance shortages!
        </p>
      </div>
    </div>
      </div>
      </div>
    </div>
</section>




  <div class="container" id="forms">
    <h1 class="mb-3 text-center fw-bold gl-text" style=" font-weight: 800; margin-top: +10px; margin-bottom: 10px; padding-top: 50px;" id="headform">
      SmartBunk Analyzer
    </h1>
    <p class="mb-3 text-center fw-light" style=" font-size: small; margin-top: -15px; color: #85858591;">by SmartBunks</p><br>

    <form action="/upload" method="post" enctype="multipart/form-data">
      <div class="row equal-columns" id="forms-sec">
        
        <!-- First card -->
        <div class="col-md-6 mb-3">
          <div class="card form-section">
            <h5 class="mb-3 text-center fw-bold glow-text" style="">Weekly Timetable</h5>
            <div class="form-group">
              <label for="schedule_Monday">Monday</label>
<textarea spellcheck="false" class="form-control" name="schedule_Monday" rows="1" placeholder="e.g., Math, Physics">{{ schedule_Monday or '' }}</textarea>
            </div>
            <div class="form-group">
              <label for="schedule_Tuesday">Tuesday</label>
              <textarea spellcheck="false" class="form-control" name="schedule_Tuesday" rows="1" placeholder="e.g., English, Chemistry">{{ schedule_Tuesday or '' }}</textarea>
            </div>
            <div class="form-group">
              <label for="schedule_Wednesday">Wednesday</label>
              <textarea spellcheck="false" class="form-control" name="schedule_Wednesday" rows="1" placeholder="e.g., Biology, Lab">{{ schedule_Wednesday or '' }}</textarea>
            </div>
            <div class="form-group">
              <label for="schedule_Thursday">Thursday</label>
              <textarea spellcheck="false" class="form-control" name="schedule_Thursday" rows="1" placeholder="e.g., Math, CS Lab">{{ schedule_Thursday or '' }}</textarea>
            </div>
            <div class="form-group">
              <label for="schedule_Friday">Friday</label>
              <textarea spellcheck="false" class="form-control" name="schedule_Friday" rows="1" placeholder="e.g., Physics, English">{{ schedule_Friday or '' }}</textarea>
            </div>
            <div class="form-group">
              <label for="schedule_Saturday">Saturday</label>
              <textarea spellcheck="false" class="form-control" name="schedule_Saturday" rows="1" placeholder="e.g., Workshop, Seminar">{{ schedule_Saturday or '' }}</textarea>
            </div>
          </div>
        </div>


        <!--  Second card -->
        <div class="col-md-6 mb-3">
          <div class="card form-section form-left">
            <h5 class="mb-3 text-center fw-bold glow-text" style="">Basic Info</h5>
            <div class="form-group">
              <label for="start_date">Start Date</label>
              <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date or '' }}" required>
            </div>
            <div class="form-group">
              <label for="end_date">End Date</label>
<input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date or '' }}" required>
            </div>
            <div class="form-group">
              <label for="threshold">Attendance Threshold (%)</label>
<input type="number" step="any" class="form-control" id="threshold" name="threshold" min="0" max="100.0" value="{{ threshold or 75 }}" placeholder="75" required>
            </div>
            <div class="form-group">
              <!-- <label>Custom Holidays File ( <span class="" style="font-weight: 100; font-size:small;">Default file: National Holidays</span> )</label> -->
               <label>
  Custom Holidays(<span style="font-weight: 400; font-size: 0.85em; color: #888;">*Optional</span>)
  <p style="font-weight: 400; font-size: 0.85em; color: #971804;">
    (If no custom file uploaded then Default: National Holidays)
  </p>
</label>

              <input type="file" class="form-control-file" name="holidays" placeholder="Default National Holidays Chosen" style="margin-top: -15px;">
              <small class="form-text text-primary">
                <a href="/download-default-kiit-holidays" target="_blank">Download KIIT-Holiday-List</a>
              </small>
              <small class="form-text text-primary">
                <a href="/download-default-holidays" target="_blank">Download Default-list, edit according to your institution and upload.</a>
              </small>
            </div><br>
            <div class="text-center mb-4">
              <button type="submit" class="btn btn-success btn- px-4">Calculate Bunk Allowance</button>
            </div>
          </div>
        </div>
      </div>
    </form>

      {% if result %}
<div class="card glass-card" id="attendance-summary">
  <h5 class="mb-3 glow-text">Attendance Summary</h5>
  <div class="glass-table">
    {{ result|safe }}
  </div>
</div>
{% endif %}


  <footer class="text-center py-3 mt-5 border-top" style="font-size: 0.95rem; color: #666;">
    SmartBunks by <strong>Anshuman</strong>
  </footer>

  
  <script>  
  // Auto-scroll to summary if it exists
  window.addEventListener('DOMContentLoaded', function () {
    const summary = document.getElementById('attendance-summary');
    if (summary) {
      summary.scrollIntoView({ behavior: 'smooth' });
    }
  });

  // JS for saving form inputs 
    window.addEventListener('beforeunload', function () {
      const formElements = document.querySelectorAll('input, textarea');
      formElements.forEach(el => {
        if (el.type !== 'file') {
          localStorage.setItem(el.name || el.id, el.value);
        }
      });
    });

    window.addEventListener('DOMContentLoaded', function () {
      const wasRestored = localStorage.getItem('wasRestored');
      if (!wasRestored) {
        const formElements = document.querySelectorAll('input, textarea');
        formElements.forEach(el => {
          if (el.type !== 'file') {
            const stored = localStorage.getItem(el.name || el.id);
            if (stored) el.value = stored;
          }
        });
        localStorage.setItem('wasRestored', 'true');
      } else {
        const keysToKeep = ['wasRestored'];
        Object.keys(localStorage).forEach(key => {
          if (!keysToKeep.includes(key)) {
            localStorage.removeItem(key);
          }
        });
        localStorage.removeItem('wasRestored');
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  {% if auto_scroll %}
<script>
  window.addEventListener("load", () => {
      const el = document.getElementById("attendance-summary");
      if (el) el.scrollIntoView({behavior: "auto"});
  });
</script>
{% endif %}
<script>
  // Activate nav item on click
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll(".navbar-nav .nav-link");

    navLinks.forEach(link => {
      link.addEventListener("click", function () {
        navLinks.forEach(l => l.classList.remove("active")); // Remove from all
        this.classList.add("active"); // Add to clicked
      });
    });
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const sections = document.querySelectorAll('#home, #headform, #attendance-summary');
    const navLinks = document.querySelectorAll('.nav-link[data-section]');

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');
          navLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('data-section') === id);
          });
        }
      });
    }, {
      rootMargin: '-50% 0px -50% 0px',
      threshold: 0.5
    });

    sections.forEach(section => {
      if (section) observer.observe(section);
    });
  });
</script>

<script>
  document.addEventListener("click", function (event) {
    const navbarToggler = document.querySelector(".navbar-toggler");
    const navbarCollapse = document.querySelector(".navbar-collapse");

    const isClickInside = navbarCollapse.contains(event.target) || navbarToggler.contains(event.target);
    const isExpanded = navbarToggler.getAttribute("aria-expanded") === "true";

    if (!isClickInside && isExpanded) {
      navbarToggler.click(); // Programmatically collapse it
    }
  });
</script>


</body>
</html>